---
title: חיבור לתיקיה של Common Data Model באמצעות חשבון Azure Data Lake
description: עבוד עם נתונים של Common Data Model באמצעות Azure Data Lake Storage.
ms.date: 09/29/2022
ms.topic: how-to
author: mukeshpo
ms.author: mukeshpo
ms.reviewer: v-wendysmith
manager: shellyha
searchScope:
- ci-data-sources
- ci-create-data-source
- ci-attach-cdm
- customerInsights
ms.openlocfilehash: c12603b9ed8a814356a0f8d0137e97afc749b87c
ms.sourcegitcommit: be341cb69329e507f527409ac4636c18742777d2
ms.translationtype: HT
ms.contentlocale: he-IL
ms.lasthandoff: 09/30/2022
ms.locfileid: "9609943"
---
# <a name="connect-to-data-in-azure-data-lake-storage"></a>התחבר לנתונים ב- Azure Data Lake Storage

אפשר לעבד נתונים לתוך Dynamics 365 Customer Insights באמצעות חשבון Azure Data Lake Storage Gen2שלך. עיבוד הנתונים יכולה להיות מלאה או מצטברת.

## <a name="prerequisites"></a>דרישות מוקדמות

- עיבוד נתונים נתמכת בחשבונות Azure Data Lake Storage *Gen2* באופן בלעדי. לא ניתן להשתמש בחשבונות אחסון של Azure Data Lake Gen1 לעיבוד נתונים.

- יש להפעיל  [מרחב שמות הירארכי](/azure/storage/blobs/data-lake-storage-namespace) עבור חשבון ה- Azure Data Lake Storage. הנתונים חייבים להיות מאוחסנים בפורמט תיקיה היררכית המגדירה את תיקיית הבסיס ושמכיל תיקיות משנה עבור כל ישות. לתיקיות המשנה יכולות להכיל תיקיות לנתונים מלאים או לנתונים מצטברים.

- כדי לאמת עם מנהל שירות של Azure, ודא שהוא מוגדר בדייר שלך. לקבלת מידע נוסף, ראה [חיבור חשבון Azure Data Lake Storage Gen2 אל מנהל שירות של Azure](connect-service-principal.md).

- חשבון ה- Azure Data Lake Storage שאתה רוצה לחבר ולעבד נתונים ממנו חייב להיות באותו אזור Azure שבו נמצאת סביבת Dynamics 365 Customer Insights. אין תמיכה בחיבורים לתיקיית Common Data Model מ- Data Lake באזור Azure אחר. לקבלת מידע על אזור Azure של הסביבה עבור אל **מנהל מערכת** > **מערכת** > **אודות** ב-Customer Insights.

- נתונים המאוחסנים בשירותים מקוונים עשויים להיות מאוחסנים במיקום אחר מאשר המיקום שבו הנתונים מעובדים או מאוחסנים ב- Dynamics 365 Customer Insights. על-ידי ייבוא או התחברות לנתונים המאוחסנים בשירותים מקוונים, אתה מסכים להעברה ולאחסון של נתונים אלה ב- Dynamics 365 Customer Insights. [קבל מידע נוסף במרכז יחסי האמון של Microsoft.](https://www.microsoft.com/trust-center).

- מנהל שירות Customer Insights חייב להיות באחד מהתפקידים הבאים כדי לגשת לחשבון האחסון. למידע נוסף, ראה [הענקת הרשאות גישה למנהל השירות עבור חשבון האחסון](connect-service-principal.md#grant-permissions-to-the-service-principal-to-access-the-storage-account).
  - קורא נתונים של Blob אחסון
  - בעלי נתונים של Blob אחסון
  - תורם נתונים של Blob אחסון

- המשתמש שמגדיר את החיבור מקור נתונים צריך לפחות הרשאות תורם נתונים של Blob אחסון בחשבון האחסון.

- הנתונים ב- Data Lake Storage צריכים לעמוד בתקן Common Data Model לאחסון הנתונים ולהכיל את המניפסט של ה- Common Data Model כדי לייצג את הסכימה של קבצי הנתונים (csv*‎.‏ או* parquet.). המניפסט חייב לספק את הפרטים של הישויות כגון עמודות של ישויות וסוגי נתונים, ואת מיקום קובץ הנתונים וסוג הקובץ. למידע נוסף ראה [מניפסט Common Data Model](/common-data-model/sdk/manifest). אם המניפסט אינו נמצא, משתמשים שהם מנהלי מערכת בעלי גישה של בעלי נתונים של Blob אחסון או משתתף בנתונים של Blob אחסון יכולים להגדיר את הסכימה בעת עיבוד הנתונים.

## <a name="recommendations"></a>המלצות

לביצועים מיטביים, Customer Insights ממליצה על גודל מחיצה של 1GB או פחות ושמספר קבצי המחיצה בתיקייה לא יעלה על 1000.

## <a name="connect-to-azure-data-lake-storage"></a>התחברות ל- Azure Data Lake Storage

1. עבור אל **נתונים** > **מקורות נתונים**.

1. בחר **הוסף מקור נתונים**.

1. בחר **Azure Data Lake Storage**.

   :::image type="content" source="media/data_sources_ADLS.png" alt-text="תיבת דו-שיח להזנת פרטי חיבור עבור Azure Data Lake." lightbox="media/data_sources_ADLS.png":::

1. הזן **שם** עבור מקור הנתונים ו **תיאור** אופציונלי. השם מזהה באופן ייחודי את מקור נתונים, מתייחסים אליו בתהליכים במורד הזרם ולא ניתן לשנותו.

1. בחר אחת מהאפשרויות הבאות עבור **חבר את האחסון שלך באמצעות**. לקבלת מידע נוסף, ראה [חיבור Customer Insights לחשבון Azure Data Lake Storage Gen2 באמצעות מנהל שירות של Azure](connect-service-principal.md).

   - **משאב Azure**: הזן את **מזהה המשאב**. לחלופין, אם ברצונך לעבד נתונים מחשבון אחסון דרך קישור פרטי של Azure, בחר **אפשר קישור פרטי**. למידע נוסף, ראה [קישורים פרטיים](security-overview.md#set-up-an-azure-private-link).
   - **מנוי Azure**: בחר **מינוי** ולאחר מכן את **קבוצת משאבים** ו **חשבון אחסון**. לחלופין, אם ברצונך לעבד נתונים מחשבון אחסון דרך קישור פרטי של Azure, בחר **אפשר קישור פרטי**. למידע נוסף, ראה [קישורים פרטיים](security-overview.md#set-up-an-azure-private-link).
  
   > [!NOTE]
   > אתה זקוק לאחד מהתפקידים הבאים או בגורם המכיל או בחשבון האחסון כדי ליצור מקור נתונים:
   >
   >  - קורא נתונים של Blob האחסון מספיק כדי לקרוא מחשבון אחסון ולהטמיע את הנתונים ב- Customer Insights.
   >  - יש צורך בתפקיד תורם או בעלים של נתונים של Blog אחסון אם ברצונך לערוך את קובצי המניפסט ישירות ב- Customer Insights.  
  
1. בחר את השם של ה **הגורם המכיל** שמכיל את הנתונים והסיכמה (קובץ model.json או manifest.json) שממנו ייובאו הנתונים, ובחר **הבא**.
   > [!NOTE]
   > כל קובץ model.json או manifest.json המשויך למקור נתונים אחר בסביבה לא יופיע ברשימה. עם זאת, ניתן להשתמש באותו קובץ model.json או manifest.json עבור מקורות נתונים בסביבות מרובות.

1. כדי ליצור סכימה חדשה, עבור אל [צור קובץ סכימה חדש](#create-a-new-schema-file).

1. כדי להשתמש בסכימה קיימת, נווט אל התיקיה המכילה את הקובץ model.json או manifest.cdm.json. אתה יכול לחפש בתוך ספרייה כדי למצוא את הקובץ.

1. בחר את קובץ ה- json ולאחר מכן בחר **הבא**. מוצגת רשימה של ישויות זמינות

   :::image type="content" source="media/review-entities.png" alt-text="תיבת דו-שיח של רשימה של ישויות לבחירה":::

1. בחר את הישויות שברצונך לכלול.

   :::image type="content" source="media/ADLS_required.png" alt-text="תיבת דו-שיח המציגה דרוש עבור מפתח ראשי":::

   > [!TIP]
   > כדי לערוך ישות בממשק עריכת JSON, בחר את הישות ולאחר מכן **ערוך קובץ סכימה**. ערוך שינויים ובחר **שמור**.

1. עבור ישויות נבחרות הדורשות עיבוד מצטבר, המילה **נדרש** מוצגת מתחת ל **רענון מצטבר**. עבור כל אחת מהישויות הללו, ראה [הגדר רענון מצטבר עבור מקורות נתונים של Azure Data Lake](incremental-refresh-data-sources.md).

1. עבור ישויות נבחרות שבהן לא הוגדר מפתח ראשי, המילה **נדרש** מוצגת מתחת ל **מפתח ראשי**. עבור כל אחת מהישויות הללו:
   1. בחר **נדרש**. מוצג הלוח **ערוך ישות**.
   1. בחר **מפתח ראשי**. המפתח הראשי הוא תכונה ייחודית לישות. כדי שתכונה תהיה מפתח ראשי חוקי, היא לא יכולה לכלול ערכים כפולים, ערכים חסרים או ערכי null. התכונות של סוגי הנתונים 'מחרוזות', 'מספר שלם' ו-'GUID' נתמכות כמפתחות ראשיים.
   1. לחלופין, שנה את תבנית המחיצה.
   1. בחר **סגור** כדי לשמור ולסגור את הלוח.

1. בחר את מספר ה **תכונות** עבור כל ישות כלולה. מוצג הדף **ניהול תכונות**.

   :::image type="content" source="media/dataprofiling-entities.png" alt-text="תיבת דו-שיח לבחירת יצירת פרופיל נתונים.":::

   1. צור תכונות חדשות, ערוך או מחק תכונות קיימות. אתה יכול לשנות את השם, את פורמט הנתונים או להוסיף סוג סמנטי.
   1. כדי לאפשר ניתוח ויכולות אחרות, בחר **יצירת פרופיל נתונים** עבור כל הישות או עבור תכונות ספציפיות. כברירת מחדל, אף ישות לא תופעל עבור יצירת פרופיל נתונים.
   1. בחר **סיום**.

1. בחר **Save**. הדף **מקורות נתונים** נפתח ומציג את מקור נתונים החדש במצב **ריענון**.

   [!INCLUDE [progress-details-include](includes/progress-details-pane.md)]

טעינת נתונים עשויה להימשך זמן מה. לאחר רענון מוצלח, ניתן לסקור את הנתונים שעובדו בדף [**ישויות**](entities.md).

### <a name="create-a-new-schema-file"></a>צור קובץ סכימה חדש

1. בחר **קובץ סכימה חדש**.

1. הזן שם עבור הקובץ, ולאחר מכן בחר **שמור**.

1. בחר **ישות חדשה**. מוצג הלוח **ישות חדשה**.

1. הזן את שם הישות ובחר **מיקום קבצי נתונים**.
   - **מספר קבצי ‏‏csv.‏‎ או ‏‏parquet.**: דפדף לתיקיית הבסיס, בחר את סוג הדפוס והזן את הביטוי.
   - **קבצי csv. או parquet. בודדים**: דפדף לקובץ csv. או parquet. ובחר בו.

   :::image type="content" source="media/ADLS_new_entity_location.png" alt-text="תיבת דו-שיח ליצירת ישות חדשה עם מיקום קבצי נתונים מודגש.":::

1. בחר **Save**.

   :::image type="content" source="media/ADLS_new_entity_define_attributes.png" alt-text="תיבת דו-שיח להגדרה או יצירה אוטומטית של תכונות.":::

1. בחר **הגדר את התכונות** כדי להוסיף ידנית את התכונות, או בחר **צור אותם אוטומטית**. כדי להגדיר את התכונות, הזן שם, בחר את פורמט הנתונים ואת הסוג הסמנטי האופציונלי. עבור יצירה אוטומטית של תכונות:

   1. לאחר יצירת התכונות אוטומטית, בחר **סקור תכונות**. מוצג הדף **ניהול תכונות**.

   1. ודא שפורמט הנתונים נכון עבור כל תכונה.

   1. כדי לאפשר ניתוח ויכולות אחרות, בחר **יצירת פרופיל נתונים** עבור כל הישות או עבור תכונות ספציפיות. כברירת מחדל, אף ישות לא תופעל עבור יצירת פרופיל נתונים.

      :::image type="content" source="media/dataprofiling-entities.png" alt-text="תיבת דו-שיח לבחירת יצירת פרופיל נתונים.":::

   1. בחר **סיום**. הדף **בחר ישויות** מופיע.

1. המשך להוסיף ישויות ותכונות, אם רלוונטי.

1. לאחר הוספת כל הישויות, בחר **כלוֹל** כדי לכלול את הישויות בעיבוד מקור נתונים.

   :::image type="content" source="media/ADLS_required.png" alt-text="תיבת דו-שיח המציגה דרוש עבור מפתח ראשי":::

1. עבור ישויות נבחרות הדורשות עיבוד מצטבר, המילה **נדרש** מוצגת מתחת ל **רענון מצטבר**. עבור כל אחת מהישויות הללו, ראה [הגדר רענון מצטבר עבור מקורות נתונים של Azure Data Lake](incremental-refresh-data-sources.md).

1. עבור ישויות נבחרות שבהן לא הוגדר מפתח ראשי, המילה **נדרש** מוצגת מתחת ל **מפתח ראשי**. עבור כל אחת מהישויות הללו:
   1. בחר **נדרש**. מוצג הלוח **ערוך ישות**.
   1. בחר **מפתח ראשי**. המפתח הראשי הוא תכונה ייחודית לישות. כדי שתכונה תהיה מפתח ראשי חוקי, היא לא יכולה לכלול ערכים כפולים, ערכים חסרים או ערכי null. התכונות של סוגי הנתונים 'מחרוזות', 'מספר שלם' ו-'GUID' נתמכות כמפתחות ראשיים.
   1. לחלופין, שנה את תבנית המחיצה.
   1. בחר **סגור** כדי לשמור ולסגור את הלוח.

1. בחר **Save**. הדף **מקורות נתונים** נפתח ומציג את מקור נתונים החדש במצב **ריענון**.

   [!INCLUDE [progress-details-include](includes/progress-details-pane.md)]

טעינת נתונים עשויה להימשך זמן מה. לאחר רענון מוצלח, ניתן לסקור את הנתונים שעובדו בדף [**ישויות**](entities.md).

## <a name="edit-an-azure-data-lake-storage-data-source"></a>ערוך מקור נתונים של Azure Data Lake Storage

אתה יכול לעדכן את האפשרות *התחבר לחשבון אחסון באמצעות*. לקבלת מידע נוסף, ראה [חיבור Customer Insights לחשבון Azure Data Lake Storage Gen2 באמצעות מנהל שירות של Azure](connect-service-principal.md). כדי להתחבר לגורם מכיל שונה מתוך חשבון האחסון שלך, או לשנות את שם החשבון, [צור חיבור למקור נתונים חדש](#connect-to-azure-data-lake-storage).

1. עבור אל **נתונים** > **מקורות נתונים**.

1. לצד מקור הנתונים שברצונך לעדכן, בחר את **עריכה**.

   :::image type="content" source="media/data_sources_edit_ADLS.png" alt-text="תיבת דו-שיח לעריכת מקור נתונים של Azure Data Lake.":::

1. שנה כל אחד מהפרטים הבאים:

   - **תיאור**
   - **חבר את האחסון שלך באמצעות** ומידע על חיבור. אין באפשרותך לשנות מידע **גורם מכיל** בעת עדכון החיבור.
      > [!NOTE]
      > יש להקצות אחד מהתפקידים הבאים לחשבון האחסון או לגורם המכיל:
        > - קורא נתונים של Blob אחסון
        > - בעלי נתונים של Blob אחסון
        > - תורם נתונים של Blob אחסון

   - **אפשר קישור פרטי** אם ברצונך לעבד נתונים מחשבון אחסון דרך קישור פרטי של Azure. למידע נוסף, ראה [קישורים פרטיים](security-overview.md#set-up-an-azure-private-link).

1. בחר **הבא**.
1. שנה כל אחד מהבאים:
   - נווט לקובץ model.json או manifest.json אחר עם קבוצת ישויות שונה מהגורם המכיל.
   - כדי להוסיף ישויות נוספות לעיבוד, בחר **ישות חדשה**.
   - כדי להסיר ישויות שכבר נבחרו אם אין יחסי תלות, בחר את הישות ו **מחק**.
      > [!IMPORTANT]
      > אם קיימים יחסי תלות בקובץ model.json או manifest.json הקיים ובערכת הישויות, תראה הודעת שגיאה ולא תוכל לבחור קובץ model.json או manifest.json אחר. הסר יחסי תלות אלה לפני שינוי הקובץ model.json או manifest.json או צור מקור נתונים חדש עם קובץ model.json או manifest.json שבו ברצונך להשתמש כדי להימנע מהסרת יחסי התלות.
   - כדי לשנות את מיקום קובץ הנתונים או את המפתח הראשי, בחר **עריכה**.
   - כדי לשנות את נתוני המצטברים לעיבוד, ראה [הגדר רענון מצטבר עבור מקורות נתונים של Azure Data Lake](incremental-refresh-data-sources.md).
   - שנה רק את שם הישות כך שיתאים לשם הישות בקובץ ה-json.

     > [!NOTE]
     > הקפד להשאיר את שם הישות ב- Customer Insights כמו שם הישות בתוך הקובץ model.json או manifest.json לאחר הקליטה. Customer Insights מאמת את כל שמות הישויות באמצעות model.json או manifest.json במהלך כל רענון מערכת. אם שם ישות משתנה בתוך Customer Insights או מחוצה לו, מתרחשת שגיאה מכיוון ש- Customer Insights לא יכול למצוא את שם הישות החדשה בקובץ ה-json. אם שם ישות שנקלט שונה בטעות, ערוך את שם הישות ב- Customer Insights כך שיתאים לשם בקובץ ה-json.

1. בחר **תכונות** כדי להוסיף או לשנות תכונות, או לאפשר יצירת פרופיל נתונים. לאחר מכן, בחר **בוצע**.

1. יש ללחוץ על **שמור** כדי להחיל את השינויים ולחזור לדף **מקורות נתונים**.

   [!INCLUDE [progress-details-include](includes/progress-details-pane.md)]

## <a name="common-reasons-for-ingestion-errors-or-corrupt-data"></a>סיבות נפוצות לשגיאות בקליטת אירועים או נתונים פגומים

במהלך קליטת נתונים, הסיבות הנפוצות ביותר לכך שרשומה עשויה להיחשב פגומה כוללות:

- סוגי הנתונים וערכי השדות אינם תואמים בין קובץ המקור לסכימה
- מספר העמודות בקובץ המקור אינו תואם לסכימה
- שדות מכילים תווים שגורמים לעמודות להתעוות בהשוואה לסכימה הצפויה. לדוגמה: מירכאות בתבנית שגויה, מירכאות ללא תו Escape או תווי שורה חדשה, או תווים לשונית.
- חסרים קובצי מחיצה
- אם מופיעות העמודות datetime/date/datetimeoffset יש לציין את הפורמט שלהן בסכימה אם הוא לא תואם לפורמט הסטנדרטי.

### <a name="schema-or-data-type-mismatch"></a>אי התאמה של סכימה או סוג נתונים

אם הנתונים אינם תואמים לסכימה, תהליך ההטמעה יסתיים עם שגיאות. תקן את נתוני המקור או את הסכימה והטמע מחדש את הנתונים.

### <a name="partition-files-are-missing"></a>חסרים קובצי מחיצה

- אם ההטמעה הצליחה ללא רשומות פגומות, אך אינך יכול לראות נתונים כלשהם, ערוך את קובץ model.json או manifest.json כדי לוודא שהמחיצות מצוינות. אחר כך, [רענן את מקור הנתונים](data-sources.md#refresh-data-sources).

- אם הטמעת נתונים מתרחשת במקביל לרענון מקורות נתונים במהלך רענון לוח זמנים אוטומטי, ייתכן שקובצי המחיצה יהיו ריקים או לא זמינים לעיבוד של Customer Insights. כדי ליישר קו עם לוח הזמנים של הרענון במעלה הזרם, שנה את [לוח זמנים לרענון המערכת](schedule-refresh.md) או את לוח הזמנין לרענון של מקור נתונים. התאם את התזמון כך שפעולות הרענון לא יתרחשו בבת אחת ויספקו את הנתונים העדכניים ביותר לעיבוד ב- Customer Insights.

### <a name="datetime-fields-in-the-wrong-format"></a>התבנית השדה 'תאריך שעה' לא נכונה

שדות התאריך והשעה בישות אינם בפורמט ISO 8601 או en-US. פורמט ברירת המחדל של 'תאריך ושעה' ב- Customer Insights הוא פורמט en-US. כל שדות התאריך והשעה בישות חייבים להיות באותו פורמט. האפליקציה Customer Insights תומכת בפורמטים אחרים בתנאי שהערות או תכונות מבוצעות ברמת המקור או הישות במודל או ב- manifest.json. לדוגמה: 

**Model.json**

   ```json
      "annotations": [
        {
          "name": "ci:CustomTimestampFormat",
          "value": "yyyy-MM-dd'T'HH:mm:ss:SSS"
        },
        {
          "name": "ci:CustomDateFormat",
          "value": "yyyy-MM-dd"
        }
      ]   
   ```

  ב- manifes.json, ניתן לציין את פורמט התאריך והשעה ברמת הישות או ברמת התכונה. ברמת הישות, השתמש ב-"exhibitsTraits" בישות ב- ‏‎*.manifest.cdm.json כדי להגדיר את פורמט התאריך והשעה. ברמת התכונה, השתמש ב-"appliedTraits" בתכונה ב- entityname.cdm.json.

**Manifest.json ברמת הישות**

```json
"exhibitsTraits": [
    {
        "traitReference": "is.formatted.dateTime",
        "arguments": [
            {
                "name": "format",
                "value": "yyyy-MM-dd'T'HH:mm:ss"
            }
        ]
    },
    {
        "traitReference": "is.formatted.date",
        "arguments": [
            {
                "name": "format",
                "value": "yyyy-MM-dd"
            }
        ]
    }
]
```

**Manifest.json ברמת התכונה**

```json
   {
      "name": "PurchasedOn",
      "appliedTraits": [
        {
          "traitReference": "is.formatted.date",
          "arguments" : [
            {
              "name": "format",
              "value": "yyyy-MM-dd"
            }
          ]
        },
        {
          "traitReference": "is.formatted.dateTime",
          "arguments" : [
            {
              "name": "format",
              "value": "yyyy-MM-ddTHH:mm:ss"
            }
          ]
        }
      ],
      "attributeContext": "POSPurchases/attributeContext/POSPurchases/PurchasedOn",
      "dataFormat": "DateTime"
    }
```

[!INCLUDE [footer-include](includes/footer-banner.md)]
